<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TLOU - Perfil </title>
    <link rel="icon" href="Assets/Imgs/Logo.png" type="image/x-icon">
    <link rel="stylesheet" href="CSS/dashboard.css">
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.0.0/uicons-bold-straight/css/uicons-bold-straight.css'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.0.0/uicons-bold-rounded/css/uicons-bold-rounded.css'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.0.0/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>

</head>

<body>
    <nav>
        <ul>
            <li>
                <a href="#" class="logo">
                    <img src="Assets/Imgs/Logo.png">
                    <span class="nav-item"> THE LAST OF US </span>
                </a>
            </li>
            <li><a href="#">
                    <i class="fi fi-sr-home"></i>
                    <span class="nav-item">Home</span>
                </a></li>
            <li><a href="#">
                    <i class="fi fi-sr-user"></i>
                    <span id="userName" class="nav-item">Olá,user</span>
                </a></li>
            <li><a href="sugestoes.html">
                    <i class="fi fi-sr-envelope"></i>
                    <span class="nav-item">Sugestões</span>
                </a></li>
            <li><a href="quiz.html">
                    <i class="fi fi-br-list-check"></i>
                    <span class="nav-item">Quiz</span>
                </a></li>
            <li><a href="index.html" class="logout" target="_blank">
                    <i class="fi fi-bs-sign-out-alt"></i>
                    <span class="nav-item">Sair</span>
                </a></li>
        </ul>
    </nav>

    <div class="kpis">
        <div class="card">
            <i class="fi fi-sr-user"></i>
            <span>Quantidade de Usuários Cadastrados</span>
            <p id="qtd_Usuarios"></p>
        </div>
        <div class="card">
            <i id="check" class="fi fi-ss-social-network"></i>
            <span>Quantidade de Usuários Acima da Média</span>
            <p id="qtd_UsuariosAcimaMedia"></p>
        </div>
        <div class="card">
            <i id="uncheck" class="fi fi-ss-hand"></i>
            <span>Quantidade de Usuários Abaixo da Média</span>
            <p id="qtd_UsuariosAbaixoMedia"></p>
        </div>
        <div class="card">
            <i id="medal" class="fi fi-sr-badge"></i>
            <span>Usuários com 100% de Taxa de Acerto no Quiz</span>
            <p id="qtd_UsuariosTaxaAcerto"></p>
        </div>
    </div>

    <div class="leaderboard">
        <div class="description"><br>
            <h3>Ranking</h3><br>
            <p>Veja o Ranking dos Usuarios que acessaram o site</p><br>
            <input class="search" placeholder="Pesquisar" id="search" onkeyup="search()">
            <table>
                <thead>
                    <tr>
                        <td></td>
                        <td>
                            Jogador
                        </td>
                        <td>
                            Pontuação
                        </td>
                        <td>
                            Taxa de Acerto
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="winner"> 1</td>
                        <td>
                            <p id="primeiroRank"></p>

                        </td>
                        <td id="primeiroRankPont"></td>
                        <td id="primeiroPorct"></td>
                    </tr>

                    <tr>
                        <td id="runner-up">2</td>
                        <td>
                            <p id="segundoRank"></p>
                        </td>
                        <td id="segundoRankPont"></td>
                        <td id="segundoPorct"></td>
                    </tr>

                    <tr>
                        <td id="second-runner-up">3</td>
                        <td>
                            <p id="terceiroRank"></p>
                        </td>
                        <td id="terceiroRankPont"></td>
                        <td id="terceiroPorct"></td>
                    </tr>

                    <tr>
                        <td>4</td>
                        <td>
                            <p id="quartoRank"></p>
                        </td>
                        <td id="quartoRankPont"></td>
                        <td id="quartoPorct"></td>
                    </tr>

                    <tr>
                        <td>5</td>
                        <td>
                            <p id="quintoRank"></p>
                        </td>
                        <td id="quintoRankPont"></td>
                        <td id="quintoPorct"></td>
                    </tr>


                    <tr>
                        <td>6</td>
                        <td>
                            <p id="sextoRank"></p>
                        </td>
                        <td id="sextoRankPont"></td>
                        <td id="sextoPorct"></td>
                    </tr>


                    <tr>
                        <td>7</td>
                        <td>
                            <p id="setimoRank"></p>
                        </td>
                        <td id="setimoRankPont"></td>
                        <td id="setimoPorct"></td>
                    </tr>


                    <tr>
                        <td>8</td>
                        <td>
                            <p id="oitavoRank"></p>
                        </td>
                        <td id="oitavoRankPont"></td>
                        <td id="oitavoPorct"></td>
                    </tr>


                    <tr>
                        <td>9</td>
                        <td>
                            <p id="nonoRank"></p>
                        </td>
                        <td id="nonoRankPont"></td>
                        <td id="nonoPorct"></td>
                    </tr>


                    <tr>
                        <td>10</td>
                        <td>
                            <p id="decimoRank"></p>
                        </td>
                        <td id="decimoRankPont"></td>
                        <td id="decimoPorct"></td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>
</body>

</html>
<script>
    function search() {
        var text = document.getElementById("search").value;
        const tr = document.getElementsByTagName("tr").value;
        for (let i = 1; i < tr.length; i++) {
            if (!tr[i].children[1].children[1].innerHTML.toLowerCase().includes(
                text.toLowerCase()
            )) {
                tr[i].style.display = 'none';

            }
            else {
                tr[i].style.display = '';
            }
        }
    }
</script>

<script>
    userName.innerHTML = ` Olá,  ` + sessionStorage.NOME_USUARIO;
    var qtdUsuarios = document.getElementById("qtd_Usuarios");
    var qtdMediaAlta = document.getElementById("qtd_UsuariosAcimaMedia");
    var qtdMediaBaixa = document.getElementById("qtd_UsuariosAbaixoMedia");
    var qtdAcertoTotal = document.getElementById("qtd_UsuariosTaxaAcerto");
    var primeroColocado = 0;
    var segundoColocado = 0;
    var terceiroColocado = 0;
    var quartoColocado = 0;
    var quintoColocado = 0;
    var sextoColocado = 0;
    var setimoColocado = 0;
    var oitavoColocado = 0;
    var nonoColocado = 0;
    var decimoColocado = 0;
    var id = sessionStorage.ID_USUARIO;
    var qtdTotal = 0;
    console.log(id);

    setInterval(gerarGraficos, 3000);
    function gerarGraficos() {

        fetch(`/leaderboard/coletarQtdUsuarios`,
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                }
            })

            .then(res => {
                if (!res.ok) {
                    throw new Error(`Erro na solicitação: ${res.statusText}`);
                }
                return res.json();
            })
            .then(res => {
                qtdTotal = res[0].usuariosTotal;

                qtdUsuarios.innerHTML = `
            ${qtdTotal}
        `;
            })
            .catch(error => {
                console.error("Erro no lado do cliente:", error);
            });
    }

    setInterval(exibirMediaAlta, 3000);
    function exibirMediaAlta() {

        fetch(`/leaderboard/mediaAlta/${id}`,
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                }
            })

            .then(res => {
                if (!res.ok) {
                    throw new Error(`Erro na solicitação: ${res.statusText}`);
                }
                return res.json();
            })
            .then(res => {
                qtdTotal = res[0].QtdUsuarios;

                qtd_UsuariosAcimaMedia.innerHTML = `
            ${qtdTotal}
        `;
            })
            .catch(error => {
                console.error("Erro no lado do cliente:", error);
            });
    }

    setInterval(exibirMediaBaixa, 3000);
    function exibirMediaBaixa() {

        fetch(`/leaderboard/mediaBaixa/${id}`,
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                }
            })

            .then(res => {
                if (!res.ok) {
                    throw new Error(`Erro na solicitação: ${res.statusText}`);
                }
                return res.json();
            })
            .then(res => {
                qtdTotal = res[0].QtdUsuarios;

                qtd_UsuariosAbaixoMedia.innerHTML = `
            ${qtdTotal}
        `;
            })
            .catch(error => {
                console.error("Erro no lado do cliente:", error);
            });
    }

    setInterval(exibirTaxaAcertoTotal, 3000);
    function exibirTaxaAcertoTotal() {

        fetch(`/leaderboard/taxaAcertoTotal/${id}`,
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                }
            })

            .then(res => {
                if (!res.ok) {
                    throw new Error(`Erro na solicitação: ${res.statusText}`);
                }
                return res.json();
            })
            .then(res => {
                qtdTotal = res[0].QtdUsuarios;

                qtd_UsuariosTaxaAcerto.innerHTML = `
            ${qtdTotal}
        `;
            })
            .catch(error => {
                console.error("Erro no lado do cliente:", error);
            });
    }


    setInterval(mostrarRanking, 3000);
    function mostrarRanking() {

        fetch(`/leaderboard/mostrarRanking/${id}`,
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                }
            })

            .then(res => {
                if (!res.ok) {
                    throw new Error(`Erro na solicitação: ${res.statusText}`);
                }
                return res.json();
            })
            .then(res => {
                console.log(res)
                //Pega o objeto inteiro
                primeiroColocado = res[0];
                segundoColocado = res[1];
                terceiroColocado = res[2];
                quartoColocado = res[3];
                quintoColocado = res[4];
                sextoColocado = res[5];
                setimoColocado = res[6];
                oitavoColocado = res[7];
                nonoColocado = res[8];
                decimoColocado = res[9];

                // Pega a propriedade nome dentro do objeto
                primeiroRank.innerHTML = primeiroColocado.Nome;
                segundoRank.innerHTML = segundoColocado.Nome;
                terceiroRank.innerHTML = terceiroColocado.Nome;
                quartoRank.innerHTML = quartoColocado.Nome;
                quintoRank.innerHTML = quintoColocado.Nome;
                sextoRank.innerHTML = sextoColocado.Nome;
                setimoRank.innerHTML = setimoColocado.Nome;
                oitavoRank.innerHTML = oitavoColocado.Nome;
                nonoRank.innerHTML = nonoColocado.Nome;
                decimoRank.innerHTML = decimoColocado.Nome;

                // Pega a propriedade Pontuação dentro do objeto
                primeiroRankPont.innerHTML = primeiroColocado.Pontuação;
                segundoRankPont.innerHTML = segundoColocado.Pontuação;
                terceiroRankPont.innerHTML = terceiroColocado.Pontuação;
                quartoRankPont.innerHTML = quartoColocado.Pontuação;
                quintoRankPont.innerHTML = quintoColocado.Pontuação;
                sextoRankPont.innerHTML = sextoColocado.Pontuação;
                setimoRankPont.innerHTML = setimoColocado.Pontuação;
                oitavoRankPont.innerHTML = oitavoColocado.Pontuação;
                nonoRankPont.innerHTML = nonoColocado.Pontuação;
                decimoRankPont.innerHTML = decimoColocado.Pontuação;

                var percentualPrimeiro = ((primeiroColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualSegundo = ((segundoColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualTerceiro = ((terceiroColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualQuarto = ((quartoColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualQuinto = ((quintoColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualSexto = ((sextoColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualSetimo= ((setimoColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualOitavo = ((oitavoColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualNono = ((nonoColocado.Pontuação / 12) * 100).toFixed(2);
                var percentualDecimo = ((decimoColocado.Pontuação / 12) * 100).toFixed(2);

                //Pega a pontuação do usuario e trasnforma em porcentagem
                primeiroPorct.innerHTML = `${percentualPrimeiro}%`;
                segundoPorct.innerHTML = `${percentualSegundo}%`;
                terceiroPorct.innerHTML = `${percentualTerceiro}%`;
                quartoPorct.innerHTML = `${percentualQuarto}%`;
                quintoPorct.innerHTML = `${percentualQuinto}%`;
                sextoPorct.innerHTML= `${percentualSexto}%`;
                setimoPorct.innerHTML= `${percentualSetimo}%`;
                oitavoPorct.innerHTML= `${percentualOitavo}%`;
                nonoPorct.innerHTML= `${percentualNono}%`;
                decimoPorct.innerHTML = `${percentualDecimo}%`;
                
            })
            .catch(error => {
                console.error("Erro no lado do cliente:", error);
            });
    }
    mostrarRanking()

</script>